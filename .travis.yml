sudo: required

language: java

env:
  global:
     - TAG=${TRAVIS_COMMIT::6}

services:
  - docker

install:
  - mvn clean install -DskipTests

script:
  - echo "Running tests..."
  - mvn test

after_success:
  - docker --version
  - docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"
  - docker images ls -a
  - echo "Building docker images..."
  - docker build -t atum-mysql:$TAG -f build/Dockerfile.mysql .
  - docker build -t atum-tomcat:$TAG -f build/Dockerfile.tomcat .
  - echo "Tagging images..."
  - docker tag atum-mysql:$TAG vaibhavdesai137/atum-mysql:$TAG
  - docker tag atum-tomcat:$TAG vaibhavdesai137/atum-tomcat:$TAG
  - echo "Pushing images to docker hub..."
  - docker push atum
  - docker images ls -a
  
before_deploy:
  - echo "Nothing in before_deploy"

after_deploy:
  - echo "Nothing in after_deploy"

cache:
  directories:
  - $HOME/.m2